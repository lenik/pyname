#!/usr/bin/env python3
"""test-zh: Check if filenames contain Chinese characters.

Copyright (C) 2026 Lenik <pyname@bodz.net>
License: GPL
"""

import argparse
import sys


def contains_chinese(text: str) -> bool:
    """Check if text contains any Chinese character."""
    for char in text:
        if '\u4e00' <= char <= '\u9fff':
            return True
    return False


def is_full_chinese(text: str) -> bool:
    """Check if text contains only Chinese characters (and whitespace)."""
    if not text.strip():
        return False
    for char in text:
        if char.isspace():
            continue
        if not ('\u4e00' <= char <= '\u9fff'):
            return False
    return True


def test_zh(
    filenames: list[str],
    contains_mode: bool = True,
    full_mode: bool = False,
    all_mode: bool = True,
    any_mode: bool = False,
) -> int:
    """
    Test if filenames contain Chinese characters.
    
    Args:
        filenames: List of filenames to test
        contains_mode: Check if contains any Chinese char (default)
        full_mode: Check if contains only Chinese chars
        all_mode: All names must meet condition (default)
        any_mode: Any name must meet condition
    
    Returns:
        Exit code: 0 if condition met, 1 otherwise
    """
    if not filenames:
        return 1
    
    # Determine test function
    test_func = is_full_chinese if full_mode else contains_chinese
    
    # Test each filename
    results = [test_func(name) for name in filenames]
    
    # Determine if condition is met
    if any_mode:
        condition_met = any(results)
    else:  # all_mode
        condition_met = all(results)
    
    return 0 if condition_met else 1


def main() -> int:
    """Main entry point."""
    parser = argparse.ArgumentParser(
        prog='test-zh',
        description='Check if filenames contain Chinese characters',
    )
    parser.add_argument(
        'filenames',
        nargs='+',
        help='Filenames to test',
    )
    test_group = parser.add_mutually_exclusive_group()
    test_group.add_argument(
        '-c', '--contains',
        action='store_true',
        help='Check if name contains any Chinese char (default)',
    )
    test_group.add_argument(
        '-f', '--full',
        action='store_true',
        help='Check if name contains Chinese chars only',
    )
    test_mode_group = parser.add_mutually_exclusive_group()
    test_mode_group.add_argument(
        '-a', '--all',
        action='store_true',
        help='All names must meet condition (default)',
    )
    test_mode_group.add_argument(
        '-1', '--any',
        action='store_true',
        help='Any name must meet condition',
    )
    
    args = parser.parse_args()
    
    return test_zh(
        filenames=args.filenames,
        contains_mode=not args.full,  # Default to contains mode unless --full is specified
        full_mode=args.full,
        all_mode=not args.any,  # Default to all mode unless --any is specified
        any_mode=args.any,
    )


if __name__ == '__main__':
    sys.exit(main())
